@* Minimal CodeMirror prototype - shows placeholder DOM and placeholder controls *@
<div class="codemirror-editor-placeholder text-monospace p-2 bg-light border" role="region" @attributes="AdditionalAttributes">
  <div class="mb-2"><strong>CodeMirror (prototype)</strong></div>
  <div id="codemirror-editor" style="height:260px; border:1px solid var(--border); border-radius:6px; overflow:hidden;"></div>
  <div class="mt-2">
    <button class="btn btn-primary me-2" @onclick="Save">Save</button>
    <button class="btn btn-secondary" @onclick="Open">Open</button>
  </div>
</div>

@code {
    [Parameter]
    public string Value { get; set; } = string.Empty;

    [Parameter]
    public EventCallback<string> ValueChanged { get; set; }

    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    [Inject]
    private DocumentService _documentService { get; set; } = default!;

    [Inject]
    private AppState _appState { get; set; } = default!;

    private string? _cachedValue;

    private void Save()
    {
        if (_appState.ActiveDocument is null) return;
        var content = _cachedValue ?? Value;
        _documentService.UpdateContent(_appState.ActiveDocument, content);
        _ = _appState.SaveActiveAsync();
    }

    private void Open() {}
}
